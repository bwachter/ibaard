<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ibaard: /home/travis/build/bwachter/ibaard/src/netaddrinfo.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ibaard
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">netaddrinfo.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="ibaard__network_8h_source.html">ibaard_network.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ibaard__log_8h_source.html">ibaard_log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="logtypes_8h_source.html">logtypes.h</a>&quot;</code><br/>
</div>
<p><a href="netaddrinfo_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa39ad84863894269513e354ea23c3348"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="netaddrinfo_8c.html#aa39ad84863894269513e354ea23c3348">netfreeaddrinfo</a> (struct addrinfo *ai)</td></tr>
<tr class="separator:aa39ad84863894269513e354ea23c3348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12e4b49134d621825efe7d411c138cbd"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="netaddrinfo_8c.html#a12e4b49134d621825efe7d411c138cbd">netaddrinfo</a> (const char *node, const char *service, const struct addrinfo *hints, struct addrinfo **res)</td></tr>
<tr class="separator:a12e4b49134d621825efe7d411c138cbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Bernd Wachter <a href="#" onclick="location.href='mai'+'lto:'+'bwa'+'ch'+'ter'+'@l'+'art'+'.i'+'nfo'; return false;">bwach<span style="display: none;">.nosp@m.</span>ter@<span style="display: none;">.nosp@m.</span>lart.<span style="display: none;">.nosp@m.</span>info</a> </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2005-2011 </dd></dl>

<p>Definition in file <a class="el" href="netaddrinfo_8c_source.html">netaddrinfo.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a12e4b49134d621825efe7d411c138cbd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int netaddrinfo </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct addrinfo *&#160;</td>
          <td class="paramname"><em>hints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct addrinfo **&#160;</td>
          <td class="paramname"><em>res</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A wrapper around getaddrinfo() when available, emulation on other platforms</p>
<p><a class="el" href="ibaard__network_8h.html#a12e4b49134d621825efe7d411c138cbd">netaddrinfo()</a> is just a wrapper around getaddrinfo() on systems which support getaddrinfo(). On systems which don't support getaddrinfo it gets emulated using traditional socket functions. On Windows it first tries to load getaddrinfo() from DLL, and falls back to the emulation code at runtime if required.</p>
<dl class="section note"><dt>Note</dt><dd>for detailed information consult the getaddrinfo() documentation</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">node</td><td>internet host name </td></tr>
    <tr><td class="paramname">service</td><td>service name </td></tr>
    <tr><td class="paramname">hints</td><td>addrinfo structure with pointers for selecting socket address structures </td></tr>
    <tr><td class="paramname">res</td><td>a list of address structures after lookup </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, different errors on failure. Consult the getaddrinfo documentation for possible error codes </dd></dl>

<p>Definition at line <a class="el" href="netaddrinfo_8c_source.html#l00048">48</a> of file <a class="el" href="netaddrinfo_8c_source.html">netaddrinfo.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                                                    {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">int</span> err;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor"></span>  HINSTANCE _hInstance = LoadLibrary( <span class="stringliteral">&quot;ws2_32&quot;</span> );</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  int (WSAAPI *pfn_getaddrinfo) (<span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keyword">const</span> <span class="keyword">struct </span>addrinfo*, <span class="keyword">struct </span>addrinfo **);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  pfn_getaddrinfo = GetProcAddress( _hInstance, <span class="stringliteral">&quot;getaddrinfo&quot;</span> );</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="keywordflow">if</span> (pfn_getaddrinfo){</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <a class="code" href="aardlog_8c.html#a627a2fca882a514cca9defe856631b5b">logmsg</a>(L_DEBUG, <a class="code" href="logtypes_8h.html#afc22a9360b7e748ed097097956bb0548">F_NET</a>, <span class="stringliteral">&quot;Using native getaddrinfo()&quot;</span>, NULL);</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">return</span> (err=pfn_getaddrinfo(node, service, hints, res));</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if (defined(_WIN32)) || (defined(_BROKEN_IO))</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor"></span>    <span class="keyword">struct </span>hostent *hp;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">struct </span>servent *servent;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *socktype;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">int</span> port;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">struct </span>addrinfo hint, result;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keyword">struct </span>addrinfo *ai, *sai, *eai;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordtype">char</span> **addrs;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    err=0;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    memset (&amp;result, 0, <span class="keyword">sizeof</span> result);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="aardlog_8c.html#a627a2fca882a514cca9defe856631b5b">logmsg</a>(L_DEBUG, <a class="code" href="logtypes_8h.html#afc22a9360b7e748ed097097956bb0548">F_NET</a>, <span class="stringliteral">&quot;Using getaddrinfo() emulation&quot;</span>, NULL);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">/* default for hints */</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordflow">if</span> (hints == NULL){</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      memset (&amp;hint, 0, <span class="keyword">sizeof</span> hint);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      hint.ai_family = PF_UNSPEC;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      hints = &amp;hint;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">/* servname must not be NULL in this implementation */</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordflow">if</span> (service == NULL)</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a0bb00f48d6ba1e8c55b7d85c8e3a19a7">EAI_NONAME</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">/* check for tcp or udp sockets only */</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (hints-&gt;ai_socktype == SOCK_STREAM)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      socktype = <span class="stringliteral">&quot;tcp&quot;</span>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hints-&gt;ai_socktype == SOCK_DGRAM)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      socktype = <span class="stringliteral">&quot;udp&quot;</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#ac7f08e3ee3c38f7c869beb5a44c9f651">EAI_SERVICE</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    result.ai_socktype = hints-&gt;ai_socktype;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">/* Note: maintain port in host byte order to make debugging easier */</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">if</span> (isdigit (*service))</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      port = strtol (service, NULL, 10);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((servent = getservbyname (service, socktype)) != NULL)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      port = ntohs (servent-&gt;s_port);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a0bb00f48d6ba1e8c55b7d85c8e3a19a7">EAI_NONAME</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">/* if nodename == NULL refer to the local host for a client or any</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">       for a server */</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (node == NULL){</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      <span class="keyword">struct </span>sockaddr_in sin;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="comment">/* check protocol family is PF_UNSPEC or PF_INET - could try harder</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">         for IPv6 but that&#39;s more code than I&#39;m prepared to write */</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      <span class="keywordflow">if</span> (hints-&gt;ai_family == PF_UNSPEC || hints-&gt;ai_family == PF_INET)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        result.ai_family = AF_INET;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a1d195add54c14a8903441848fb2f7da6">EAI_FAMILY</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      sin.sin_family = result.ai_family;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      sin.sin_port = htons (port);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">if</span> (hints-&gt;ai_flags &amp; <a class="code" href="ibaard__types_8h.html#aec9e92ed53442d64cbc9b68d92ad970b">AI_PASSIVE</a>)</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        sin.sin_addr.s_addr = htonl (INADDR_ANY);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        sin.sin_addr.s_addr = htonl (INADDR_LOOPBACK);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">/* Duplicate result and addr and return */</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      *res = dup_addrinfo (&amp;result, &amp;sin, <span class="keyword">sizeof</span> sin);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">return</span> (*res == NULL) ? <a class="code" href="ibaard__types_8h.html#a33d8eb0c89167f95dcdaf23386631174">EAI_MEMORY</a> : 0;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="comment">/* If AI_NUMERIC is specified, use inet_addr to translate numbers and</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">       dots notation. */</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">if</span> (hints-&gt;ai_flags &amp; <a class="code" href="ibaard__types_8h.html#a2a7070b38894743c536630b2ab25dcef">AI_NUMERICHOST</a>){</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      <span class="keyword">struct </span>sockaddr_in sin;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <span class="comment">/* check protocol family is PF_UNSPEC or PF_INET */</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <span class="keywordflow">if</span> (hints-&gt;ai_family == PF_UNSPEC || hints-&gt;ai_family == PF_INET)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        result.ai_family = AF_INET;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a1d195add54c14a8903441848fb2f7da6">EAI_FAMILY</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      sin.sin_family = result.ai_family;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      sin.sin_port = htons (port);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      sin.sin_addr.s_addr = inet_addr (node);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="comment">/* Duplicate result and addr and return */</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      *res = dup_addrinfo (&amp;result, &amp;sin, <span class="keyword">sizeof</span> sin);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      <span class="keywordflow">return</span> (*res == NULL) ? <a class="code" href="ibaard__types_8h.html#a33d8eb0c89167f95dcdaf23386631174">EAI_MEMORY</a> : 0;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    hp = gethostbyname (node);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="comment">// fixme, translate error codes</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">if</span> (hp == NULL) <span class="keywordflow">return</span> h_errno;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">/* Check that the address family is acceptable.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keywordflow">switch</span> (hp-&gt;h_addrtype){</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordflow">case</span> AF_INET:</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">if</span> (!(hints-&gt;ai_family == PF_UNSPEC || hints-&gt;ai_family == PF_INET))</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a1d195add54c14a8903441848fb2f7da6">EAI_FAMILY</a>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;      <span class="keywordflow">case</span> AF_INET6:</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">if</span> (!(hints-&gt;ai_family == PF_UNSPEC || hints-&gt;ai_family == PF_INET6))</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a1d195add54c14a8903441848fb2f7da6">EAI_FAMILY</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a1d195add54c14a8903441848fb2f7da6">EAI_FAMILY</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">/* For each element pointed to by hp, create an element in the</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">       result linked list. */</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    sai = eai = NULL;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="keywordflow">for</span> (addrs = hp-&gt;h_addr_list; *addrs != NULL; addrs++){</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keyword">struct </span>sockaddr sa;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordtype">size_t</span> addrlen;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      <span class="keywordflow">if</span> (hp-&gt;h_length &lt; 1)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      sa.sa_family = hp-&gt;h_addrtype;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordflow">switch</span> (hp-&gt;h_addrtype){</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">case</span> AF_INET:</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;          ((<span class="keyword">struct </span>sockaddr_in *) &amp;sa)-&gt;sin_port = htons (port);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;          memcpy (&amp;((<span class="keyword">struct</span> sockaddr_in *) &amp;sa)-&gt;sin_addr,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                  *addrs, hp-&gt;h_length);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;          addrlen = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">case</span> AF_INET6:</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor"># if SIN6_LEN</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor"></span>          ((<span class="keyword">struct </span>sockaddr_in6 *) &amp;sa)-&gt;sin6_len = hp-&gt;h_length;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="preprocessor"></span>          ((<span class="keyword">struct </span>sockaddr_in6 *) &amp;sa)-&gt;sin6_port = htons (port);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;          memcpy (&amp;((<span class="keyword">struct</span> sockaddr_in6 *) &amp;sa)-&gt;sin6_addr,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                  *addrs, hp-&gt;h_length);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;          addrlen = <span class="keyword">sizeof</span> (<span class="keyword">struct </span>sockaddr_in6);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;          <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;          <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      result.ai_family = hp-&gt;h_addrtype;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      ai = dup_addrinfo (&amp;result, &amp;sa, addrlen);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">if</span> (ai == NULL){</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="netaddrinfo_8c.html#aa39ad84863894269513e354ea23c3348">netfreeaddrinfo</a> (sai);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a33d8eb0c89167f95dcdaf23386631174">EAI_MEMORY</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="keywordflow">if</span> (sai == NULL)</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        sai = ai;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        eai-&gt;ai_next = ai;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      eai = ai;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (sai == NULL){</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#aae1a32f26ffbb7461251d7c4a7c3a0a2">EAI_NODATA</a>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span> (hints-&gt;ai_flags &amp; <a class="code" href="ibaard__types_8h.html#ab2912e6cffeb2353df550f10bbe64cf4">AI_CANONNAME</a>){</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      sai-&gt;ai_canonname = malloc (strlen (hp-&gt;h_name) + 1);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordflow">if</span> (sai-&gt;ai_canonname == NULL){</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="netaddrinfo_8c.html#aa39ad84863894269513e354ea23c3348">netfreeaddrinfo</a> (sai);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="ibaard__types_8h.html#a33d8eb0c89167f95dcdaf23386631174">EAI_MEMORY</a>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      strcpy (sai-&gt;ai_canonname, hp-&gt;h_name);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    *res = sai;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="preprocessor"></span>  }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor"></span>  (void)err;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordflow">return</span> (getaddrinfo(node, service, hints, res));</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="preprocessor"></span>}</div>
<div class="ttc" id="ibaard__types_8h_html_a2a7070b38894743c536630b2ab25dcef"><div class="ttname"><a href="ibaard__types_8h.html#a2a7070b38894743c536630b2ab25dcef">AI_NUMERICHOST</a></div><div class="ttdeci">#define AI_NUMERICHOST</div><div class="ttdoc">Don&#39;t resolve names -&gt; you need to specify a numeric hostname. </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00094">ibaard_types.h:94</a></div></div>
<div class="ttc" id="logtypes_8h_html_afc22a9360b7e748ed097097956bb0548"><div class="ttname"><a href="logtypes_8h.html#afc22a9360b7e748ed097097956bb0548">F_NET</a></div><div class="ttdeci">#define F_NET</div><div class="ttdef"><b>Definition:</b> <a href="logtypes_8h_source.html#l00009">logtypes.h:9</a></div></div>
<div class="ttc" id="ibaard__types_8h_html_ac7f08e3ee3c38f7c869beb5a44c9f651"><div class="ttname"><a href="ibaard__types_8h.html#ac7f08e3ee3c38f7c869beb5a44c9f651">EAI_SERVICE</a></div><div class="ttdeci">#define EAI_SERVICE</div><div class="ttdoc">Service not supported for this socket type. </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00072">ibaard_types.h:72</a></div></div>
<div class="ttc" id="ibaard__types_8h_html_aae1a32f26ffbb7461251d7c4a7c3a0a2"><div class="ttname"><a href="ibaard__types_8h.html#aae1a32f26ffbb7461251d7c4a7c3a0a2">EAI_NODATA</a></div><div class="ttdeci">#define EAI_NODATA</div><div class="ttdoc">Deprecated years ago, you should use EAI_NONAME. </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00076">ibaard_types.h:76</a></div></div>
<div class="ttc" id="netaddrinfo_8c_html_aa39ad84863894269513e354ea23c3348"><div class="ttname"><a href="netaddrinfo_8c.html#aa39ad84863894269513e354ea23c3348">netfreeaddrinfo</a></div><div class="ttdeci">void netfreeaddrinfo(struct addrinfo *ai)</div><div class="ttdef"><b>Definition:</b> <a href="netaddrinfo_8c_source.html#l00030">netaddrinfo.c:30</a></div></div>
<div class="ttc" id="ibaard__types_8h_html_ab2912e6cffeb2353df550f10bbe64cf4"><div class="ttname"><a href="ibaard__types_8h.html#ab2912e6cffeb2353df550f10bbe64cf4">AI_CANONNAME</a></div><div class="ttdeci">#define AI_CANONNAME</div><div class="ttdoc">When set ai_canonname of first addrinfo struct will point to canonical name. </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00098">ibaard_types.h:98</a></div></div>
<div class="ttc" id="ibaard__types_8h_html_a33d8eb0c89167f95dcdaf23386631174"><div class="ttname"><a href="ibaard__types_8h.html#a33d8eb0c89167f95dcdaf23386631174">EAI_MEMORY</a></div><div class="ttdeci">#define EAI_MEMORY</div><div class="ttdoc">Memory allocation failure. </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00080">ibaard_types.h:80</a></div></div>
<div class="ttc" id="aardlog_8c_html_a627a2fca882a514cca9defe856631b5b"><div class="ttname"><a href="aardlog_8c.html#a627a2fca882a514cca9defe856631b5b">logmsg</a></div><div class="ttdeci">int logmsg(int level, char *facility, char *msg,...)</div><div class="ttdef"><b>Definition:</b> <a href="aardlog_8c_source.html#l00092">aardlog.c:92</a></div></div>
<div class="ttc" id="ibaard__types_8h_html_aec9e92ed53442d64cbc9b68d92ad970b"><div class="ttname"><a href="ibaard__types_8h.html#aec9e92ed53442d64cbc9b68d92ad970b">AI_PASSIVE</a></div><div class="ttdeci">#define AI_PASSIVE</div><div class="ttdoc">Set this if you want to use the address structure for bind() </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00102">ibaard_types.h:102</a></div></div>
<div class="ttc" id="ibaard__types_8h_html_a1d195add54c14a8903441848fb2f7da6"><div class="ttname"><a href="ibaard__types_8h.html#a1d195add54c14a8903441848fb2f7da6">EAI_FAMILY</a></div><div class="ttdeci">#define EAI_FAMILY</div><div class="ttdoc">Address family not recognized or address length invalid for family. </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00064">ibaard_types.h:64</a></div></div>
<div class="ttc" id="ibaard__types_8h_html_a0bb00f48d6ba1e8c55b7d85c8e3a19a7"><div class="ttname"><a href="ibaard__types_8h.html#a0bb00f48d6ba1e8c55b7d85c8e3a19a7">EAI_NONAME</a></div><div class="ttdeci">#define EAI_NONAME</div><div class="ttdoc">Name does not resolve. </div><div class="ttdef"><b>Definition:</b> <a href="ibaard__types_8h_source.html#l00068">ibaard_types.h:68</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa39ad84863894269513e354ea23c3348"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void netfreeaddrinfo </td>
          <td>(</td>
          <td class="paramtype">struct addrinfo *&#160;</td>
          <td class="paramname"><em>ai</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A wrapper around freeaddrinfo() when available, emulation on other platforms</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000024">Todo:</a></b></dt><dd>complete documentation </dd></dl>

<p>Definition at line <a class="el" href="netaddrinfo_8c_source.html#l00030">30</a> of file <a class="el" href="netaddrinfo_8c_source.html">netaddrinfo.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                           {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#if (defined(_WIN32)) || (defined(_BROKEN_IO))</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor"></span>  <span class="keyword">struct </span>addrinfo *next;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">while</span> (ai != NULL){</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    next = ai-&gt;ai_next;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (ai-&gt;ai_canonname != NULL)</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      free (ai-&gt;ai_canonname);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordflow">if</span> (ai-&gt;ai_addr != NULL)</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      free (ai-&gt;ai_addr);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    free (ai);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    ai = next;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor"></span>  freeaddrinfo(ai);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor"></span>}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 15 2018 14:50:21 for ibaard by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
